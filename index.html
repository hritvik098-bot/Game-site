<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Haunted One + Namaz Reminder</title>
  <style>
    html, body { margin:0; padding:0; overflow:hidden; background:#000; font-family: system-ui; color:#fff; }
    #hud{
      position:fixed; top:10px; left:10px; z-index:10;
      background:rgba(0,0,0,.55); padding:10px 12px; border-radius:12px;
      font-size:13px; max-width:95vw;
    }
    #hud b{font-size:14px}
    #crosshair{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      width:8px; height:8px; border:2px solid rgba(255,255,255,.8);
      border-radius:999px; z-index:10;
    }
    #msg{
      position:fixed; inset:0; display:none; z-index:20;
      background:rgba(0,0,0,.65); align-items:center; justify-content:center;
      padding:12px;
    }
    #msgInner{
      width:min(520px, 92vw); border-radius:18px;
      background:rgba(10,10,10,.9);
      border:1px solid rgba(255,255,255,.12);
      padding:18px 16px;
      text-align:center;
    }
    .btn{
      display:inline-block; margin-top:10px;
      padding:10px 14px; border-radius:12px;
      background:#fff; color:#000; cursor:pointer; user-select:none;
      font-weight:900;
    }

    /* Namaz box */
    #prayerBox{
      position:fixed; inset:0; display:none; z-index:999;
      background:rgba(0,0,0,.75);
      align-items:center; justify-content:center;
      padding:12px;
    }
    #prayerInner{
      width:min(540px, 92vw);
      background:rgba(10,10,10,.92);
      border:1px solid rgba(255,255,255,.14);
      padding:18px 16px; border-radius:18px;
      text-align:center;
    }
    #prayerSettings{
      margin-top:12px; text-align:left; font-size:14px;
      background:rgba(255,255,255,.06);
      border-radius:14px; padding:12px;
    }
    #prayerSettings input{
      width:120px; padding:8px 10px; border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:#000; color:#fff;
    }
    .row{display:flex; justify-content:space-between; gap:10px; align-items:center; margin:8px 0;}
    .small{opacity:.8; font-size:12px}
  </style>
</head>

<body>
  <div id="hud">
    <b>The Haunted One (3D Horror)</b><br/>
    Click to start ‚Ä¢ Move: <b>WASD</b> ‚Ä¢ Run: <b>Shift</b> ‚Ä¢ Flashlight: <b>F</b><br/>
    Namaz settings: <b>N</b> ‚Ä¢ Goal: Reach <b>Exit Door</b> üö™
  </div>
  <div id="crosshair"></div>

  <!-- Game Result -->
  <div id="msg">
    <div id="msgInner">
      <div id="msgText" style="font-size:18px"></div>
      <div class="btn" onclick="location.reload()">Play Again</div>
    </div>
  </div>

  <!-- Namaz Reminder -->
  <div id="prayerBox">
    <div id="prayerInner">
      <h2 id="prTitle" style="margin:0 0 8px">üïå Namaz Time</h2>
      <p id="prText" style="margin:0 0 10px;opacity:.9;line-height:1.5">
        Namaz ka waqt ho gaya hai. Game pause kar diya gaya hai.
      </p>
      <div class="btn" id="prOk">‡§†‡•Ä‡§ï ‡§π‡•à</div>

      <div id="prayerSettings">
        <b>Namaz Times (Manual Set)</b>
        <div class="small">Format HH:MM (24 hour). Example: 05:20</div>

        <div class="row"><span>Fajr</span> <input id="tFajr" type="time" value="05:30"></div>
        <div class="row"><span>Zuhr</span> <input id="tZuhr" type="time" value="13:15"></div>
        <div class="row"><span>Asr</span>  <input id="tAsr"  type="time" value="16:45"></div>
        <div class="row"><span>Maghrib</span><input id="tMag"  type="time" value="18:05"></div>
        <div class="row"><span>Isha</span> <input id="tIsha" type="time" value="19:30"></div>

        <div class="btn" id="saveTimes">Save Times</div>
        <div class="small">Press <b>N</b> to open this anytime.</div>
      </div>
    </div>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { PointerLockControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/PointerLockControls.js";

    // ---------------- Scene ----------------
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x000000, 2, 22);

    const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 100);
    camera.position.set(0, 1.6, 6);

    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0x111111));

    // Flashlight
    const flashlight = new THREE.SpotLight(0xffffff, 2.2, 16, Math.PI/7, 0.25, 1.6);
    flashlight.position.set(0, 1.6, 0);
    flashlight.target.position.set(0, 1.6, -1);
    camera.add(flashlight);
    camera.add(flashlight.target);
    scene.add(camera);

    let flashlightOn = true;

    // Controls
    const controls = new PointerLockControls(camera, document.body);
    document.body.addEventListener("click", () => controls.lock());

    // Floor
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(30, 30),
      new THREE.MeshStandardMaterial({ color: 0x1a1a1a, roughness: 1 })
    );
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Walls helper
    const wallMat = new THREE.MeshStandardMaterial({ color: 0x0b0b0b, roughness: 1 });
    function wall(w, h, d, x, y, z){
      const m = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), wallMat);
      m.position.set(x,y,z);
      scene.add(m);
      return m;
    }

    // Outer room
    wall(30, 6, 1, 0, 3, -15);
    wall(30, 6, 1, 0, 3,  15);
    wall(1,  6, 30, -15, 3, 0);
    wall(1,  6, 30,  15, 3, 0);

    // Obstacles
    const obstacles = [];
    obstacles.push(wall(10, 4, 1, 0, 2, 5));
    obstacles.push(wall(1, 4, 10, -6, 2, -2));
    obstacles.push(wall(12, 4, 1, 4, 2, -6));
    obstacles.push(wall(1, 4, 10, 7, 2, 0));

    // Exit door
    const door = new THREE.Mesh(
      new THREE.BoxGeometry(1.8, 3.4, 0.4),
      new THREE.MeshStandardMaterial({ color: 0x2a9d8f, roughness: 0.6 })
    );
    door.position.set(14, 1.7, -10);
    scene.add(door);

    // Enemy
    const enemy = new THREE.Group();
    const body = new THREE.Mesh(
      new THREE.BoxGeometry(1, 1.8, 0.6),
      new THREE.MeshStandardMaterial({ color: 0x3a0a0a, roughness: 1 })
    );
    body.position.y = 0.9;
    const head = new THREE.Mesh(
      new THREE.BoxGeometry(0.7, 0.7, 0.7),
      new THREE.MeshStandardMaterial({ color: 0x552222, roughness: 1 })
    );
    head.position.y = 2.0;
    const eyeMat = new THREE.MeshBasicMaterial({ color: 0xff0000 });
    const eye1 = new THREE.Mesh(new THREE.SphereGeometry(0.07, 16, 16), eyeMat);
    const eye2 = eye1.clone();
    eye1.position.set(-0.18, 2.05, 0.36);
    eye2.position.set( 0.18, 2.05, 0.36);
    enemy.add(body, head, eye1, eye2);
    enemy.position.set(-10, 0, -10);
    scene.add(enemy);

    // UI
    const msg = document.getElementById("msg");
    const msgText = document.getElementById("msgText");
    let gameOver = false;

    // Keys
    const keys = { w:false, a:false, s:false, d:false, shift:false };
    addEventListener("keydown", (e)=>{
      const k = e.key.toLowerCase();
      if(k in keys) keys[k] = true;
      if(e.key === "Shift") keys.shift = true;

      if(k === "f"){
        flashlightOn = !flashlightOn;
        flashlight.intensity = flashlightOn ? 2.2 : 0;
      }
    });
    addEventListener("keyup", (e)=>{
      const k = e.key.toLowerCase();
      if(k in keys) keys[k] = false;
      if(e.key === "Shift") keys.shift = false;
    });

    // Collision helpers
    function clampPlayer(){
      const p = controls.getObject().position;
      p.x = Math.max(-13.5, Math.min(13.5, p.x));
      p.z = Math.max(-13.5, Math.min(13.5, p.z));
    }

    function collidesWithObstacles(newPos){
      const playerBox = new THREE.Box3().setFromCenterAndSize(
        new THREE.Vector3(newPos.x, 1.6, newPos.z),
        new THREE.Vector3(0.6, 1.7, 0.6)
      );
      for(const o of obstacles){
        const oBox = new THREE.Box3().setFromObject(o);
        if(playerBox.intersectsBox(oBox)) return true;
      }
      return false;
    }

    // ---------------- Namaz Reminder ----------------
    const prayerBox = document.getElementById("prayerBox");
    const prTitle = document.getElementById("prTitle");
    const prText = document.getElementById("prText");
    const prOk = document.getElementById("prOk");
    const saveTimes = document.getElementById("saveTimes");
    let prayerPaused = false;

    const defaultTimes = { Fajr:"05:30", Zuhr:"13:15", Asr:"16:45", Mag:"18:05", Isha:"19:30" };

    function loadTimes(){
      const t = JSON.parse(localStorage.getItem("prayerTimes") || "null") || defaultTimes;
      tFajr.value = t.Fajr; tZuhr.value = t.Zuhr; tAsr.value = t.Asr; tMag.value = t.Mag; tIsha.value = t.Isha;
    }
    function getTimes(){
      return { Fajr:tFajr.value, Zuhr:tZuhr.value, Asr:tAsr.value, Mag:tMag.value, Isha:tIsha.value };
    }
    loadTimes();

    saveTimes.onclick = ()=>{
      localStorage.setItem("prayerTimes", JSON.stringify(getTimes()));
      prText.innerHTML = "‚úÖ Times saved. Allah tumhe kamyab kare. ü§ç";
    };

    function showPrayer(name){
      prayerPaused = true;
      prTitle.innerText = `üïå ${name} Time`;
      prText.innerHTML = `Namaz ka waqt ho gaya hai.<br><b>Game PAUSE</b> ‚úÖ`;
      prayerBox.style.display = "flex";
      try{ controls.unlock(); }catch(e){}
    }
    prOk.onclick = ()=>{
      prayerPaused = false;
      prayerBox.style.display = "none";
    };

    // N = open settings
    addEventListener("keydown", (e)=>{
      if(e.key.toLowerCase()==="n"){
        prayerBox.style.display = "flex";
        try{ controls.unlock(); }catch(err){}
      }
    });

    let firedToday = {};
    function dayKey(){
      const d = new Date();
      return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
    }
    let curDay = dayKey();
    function resetDaily(){
      const d = dayKey();
      if(d !== curDay){ curDay = d; firedToday = {}; }
    }

    function tickPrayer(){
      resetDaily();
      const now = new Date();
      const hh = String(now.getHours()).padStart(2,"0");
      const mm = String(now.getMinutes()).padStart(2,"0");
      const cur = `${hh}:${mm}`;

      const times = JSON.parse(localStorage.getItem("prayerTimes") || "null") || getTimes();
      const list = [["Fajr",times.Fajr],["Zuhr",times.Zuhr],["Asr",times.Asr],["Maghrib",times.Mag],["Isha",times.Isha]];
      for(const [name, t] of list){
        if(cur === t && !firedToday[name]){
          firedToday[name] = true;
          showPrayer(name);
          break;
        }
      }
    }
    setInterval(tickPrayer, 1000 * 10);

    // ---------------- Loop ----------------
    const clock = new THREE.Clock();

    function animate(){
      requestAnimationFrame(animate);
      const dt = Math.min(clock.getDelta(), 0.05);

      if(!gameOver && controls.isLocked && !prayerPaused){
        const speed = (keys.shift ? 5.2 : 3.2);

        const dir = new THREE.Vector3();
        const forward = new THREE.Vector3();
        controls.getDirection(forward); forward.y = 0; forward.normalize();
        const right = new THREE.Vector3().crossVectors(forward, new THREE.Vector3(0,1,0)).normalize().multiplyScalar(-1);

        if(keys.w) dir.add(forward);
        if(keys.s) dir.sub(forward);
        if(keys.a) dir.sub(right);
        if(keys.d) dir.add(right);

        if(dir.lengthSq() > 0) dir.normalize().multiplyScalar(speed * dt);

        const cur = controls.getObject().position.clone();
        const next = cur.clone().add(dir);
        if(!collidesWithObstacles(next)) controls.getObject().position.copy(next);

        clampPlayer();

        // enemy chase
        const playerPos = controls.getObject().position;
        const toPlayer = new THREE.Vector3().subVectors(playerPos, enemy.position);
        const dist = toPlayer.length();

        const enemySpeed = flashlightOn ? 1.2 : 2.2;
        toPlayer.y = 0;
        if(dist > 0.01){
          toPlayer.normalize();
          enemy.position.add(toPlayer.multiplyScalar(enemySpeed * dt));
        }
        enemy.lookAt(playerPos.x, enemy.position.y + 1.2, playerPos.z);

        if(dist < 1.2){
          gameOver = true;
          msgText.innerHTML = "üíÄ THE HAUNTED ONE CAUGHT YOU!<br/>Jumpscare!";
          msg.style.display = "flex";
          try{ controls.unlock(); }catch(e){}
        }

        if(door.position.distanceTo(playerPos) < 1.6){
          gameOver = true;
          msgText.innerHTML = "‚úÖ YOU ESCAPED!<br/>Something is still behind you...";
          msg.style.display = "flex";
          try{ controls.unlock(); }catch(e){}
        }
      }

      renderer.render(scene, camera);
    }
    animate();

    addEventListener("resize", ()=>{
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });
  </script><!-- ‚úÖ MOBILE TOUCH CONTROLS -->
<style>
  #touchUI{position:fixed;inset:0;z-index:999999;pointer-events:none;font-family:Arial}
  #joy{position:absolute;left:16px;bottom:18px;width:160px;height:160px;border-radius:50%;
    background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);pointer-events:auto;touch-action:none}
  #knob{position:absolute;left:50%;top:50%;width:70px;height:70px;margin:-35px 0 0 -35px;border-radius:50%;
    background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.22)}
  #btns{position:absolute;right:16px;bottom:20px;display:flex;flex-direction:column;gap:10px;pointer-events:auto}
  .btn{width:64px;height:64px;border-radius:18px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.18);
    color:#fff;font-weight:700;display:flex;align-items:center;justify-content:center;touch-action:none;user-select:none}
  #look{position:absolute;right:16px;bottom:220px;width:190px;height:190px;border-radius:50%;
    background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);pointer-events:auto;touch-action:none}
  @media (hover:hover) and (pointer:fine){#touchUI{display:none}}
</style>

<div id="touchUI">
  <div id="joy"><div id="knob"></div></div>
  <div id="look"></div>

  <div id="btns">
    <div class="btn" id="btnF">F</div>
    <div class="btn" id="btnJump">‚§í</div>
    <div class="btn" id="btnRun">RUN</div>
  </div>
</div>

<script>
(()=> {
  const isTouch=('ontouchstart'in window)||(navigator.maxTouchPoints>0);
  if(!isTouch) return;

  const down=new Set();
  const kd=(code)=>{if(down.has(code))return;down.add(code);
    document.dispatchEvent(new KeyboardEvent('keydown',{code,bubbles:true}))}
  const ku=(code)=>{if(!down.has(code))return;down.delete(code);
    document.dispatchEvent(new KeyboardEvent('keyup',{code,bubbles:true}))}

  // joystick => WASD
  const joy=document.getElementById('joy'), knob=document.getElementById('knob');
  let active=false,cx=0,cy=0;
  const set=(dx,dy)=>{
    const max=45,len=Math.hypot(dx,dy)||1,cl=Math.min(len,max);
    const nx=dx/len*cl, ny=dy/len*cl;
    knob.style.transform=`translate(${nx}px,${ny}px)`;
    const dead=14;
    (nx<-dead)?kd('KeyA'):ku('KeyA');
    (nx> dead)?kd('KeyD'):ku('KeyD');
    (ny<-dead)?kd('KeyW'):ku('KeyW');
    (ny> dead)?kd('KeyS'):ku('KeyS');
  }
  joy.addEventListener('pointerdown',e=>{
    active=true;joy.setPointerCapture(e.pointerId);
    const r=joy.getBoundingClientRect();cx=r.left+r.width/2;cy=r.top+r.height/2;
    set(e.clientX-cx,e.clientY-cy);
  });
  joy.addEventListener('pointermove',e=>{if(active)set(e.clientX-cx,e.clientY-cy)});
  joy.addEventListener('pointerup',()=>{active=false;knob.style.transform='translate(0,0)';
    ['KeyW','KeyA','KeyS','KeyD'].forEach(ku)});

  // look pad => mouse move
  const look=document.getElementById('look');
  let lx=0,ly=0,looking=false;
  look.addEventListener('pointerdown',e=>{looking=true;look.setPointerCapture(e.pointerId);lx=e.clientX;ly=e.clientY});
  look.addEventListener('pointermove',e=>{
    if(!looking) return;
    const dx=e.clientX-lx, dy=e.clientY-ly; lx=e.clientX; ly=e.clientY;
    document.dispatchEvent(new MouseEvent('mousemove',{movementX:dx,movementY:dy,bubbles:true}));
  });
  look.addEventListener('pointerup',()=>looking=false);

  // buttons
  const bind=(id,code)=>{
    const el=document.getElementById(id);
    el.addEventListener('pointerdown',e=>{e.preventDefault();kd(code)});
    el.addEventListener('pointerup',e=>{e.preventDefault();ku(code)});
    el.addEventListener('pointercancel',e=>{e.preventDefault();ku(code)});
  }
  bind('btnRun','ShiftLeft');
  bind('btnJump','Space');
  bind('btnF','KeyF');
})();
</script>
<!-- ‚úÖ MOBILE TOUCH CONTROLS END -->
</body>
</html>
